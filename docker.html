<!DOCTYPE html []>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="author" content="MarkdownViewer++" />
    <title>docker.md</title>
    <style type="text/css">
            /* Avoid page breaks inside the most common attributes, especially for exports (i.e. PDF) */
td, h1, h2, h3, h4, h5, p, ul, ol, li {
    page-break-inside: avoid; 
}

            
        </style>
  </head>
  <body>
    <h1>Docker简介</h1>
    <h2>一、运行 tomcat 8.5</h2>
    <h3>1. 部署 tomcat 8.5</h3>
    <ul>
      <li>1.下载并运行，<em>docker run -dit --name tomcat -p 8080:8080 tomcat:8.5</em></li>
      <li>2.查看镜像，<em>docker images</em></li>
      <li>3.查看容器，<em>docker ps -a</em></li>
    </ul>
    <h3>2. 添加管理员</h3>
    <ul>
      <li>1.使用浏览器打开 http://127.0.0.1:8080/，可以看见首页，但是无法进入管理界面。</li>
      <li>2.进入容器内查看文件，<em>docker exec -it tomcat bash</em></li>
      <li>3.复制 tomcat-users.xml，<em>docker cp <a target="_blank" href="http://pan.baidu.com/s/1o8Lwg6Q">tomcat-users.xml</a> tomcat:/usr/local/tomcat/conf/</em></li>
      <li>4.复制 manager.xml，<em>docker cp <a target="_blank" href="http://pan.baidu.com/s/1o7PPHDC">manager.xml</a> tomcat:/usr/local/tomcat/conf/Catalina/localhost/</em></li>
    </ul>
    <h3>3. 重新运行容器</h3>
    <ul>
      <li>1.停止容器，<em>docker stop tomcat</em></li>
      <li>2.启动容器，<em>docker start tomcat</em></li>
      <li>3.使用浏览器打开 http://127.0.0.1:8080/，部署WebApp。</li>
    </ul>
    <h3>4. 移除</h3>
    <ul>
      <li>1.删除容器，<em>docker rm tomcat</em></li>
      <li>2.获取镜像标识符，<em>docker images</em> 获取 ImageID</li>
      <li>3.删除镜像，<em>docker rmi &lt;ImageID&gt;</em></li>
    </ul>
    <h2>二、运行 Spring Boot 应用</h2>
    <h3>1. 部署 MySQL 数据库</h3>
    <ul>
      <li>1.下载并运行，<em>docker run --name mysql -e MYSQL_ROOT_PASSWORD=Techown1 -d mysql:5.5</em></li>
      <li>2.进入容器，<em>docker exec -it mysql bash</em></li>
      <li>3.创建 auth 数据库</li>
    </ul>
    <h3>2. 部署 Spring Boot 应用</h3>
    <ul>
      <li>1.下载 <a target="_blank" href="http://pan.baidu.com/s/1mhXvrew">auth.jar</a> 和 <a target="_blank" href="http://pan.baidu.com/s/1qYDkAPA">auth.dockerfile</a></li>
      <li>2.生成镜像，<em>docker build -t auth:0.1 -f auth.dockerfile .</em></li>
      <li>3.查看镜像，<em>docker images</em></li>
      <li>4.启动应用，<em>docker run --name auth -p 8080:8088 --link mysql:localhost -d auth:0.1</em></li>
      <li>5.查看日志，<em>docker logs -f auth</em></li>
      <li>6.调用应用 http://localhost:8080/authr/sleep</li>
      <li>7.查看监控 http://localhost:8080/jolokia/read/java.lang:type=Memory</li>
    </ul>
    <h3>3. 其他命令</h3>
    <ul>
      <li>1.查看容器运行状态，<em>docker stats auth</em></li>
      <li>2.查看镜像细节，<em>docker image inspect auth:0.1</em></li>
      <li>3.查看容器细节，<em>docker container inspect auth</em></li>
    </ul>
    <h3>4. 其他容器运行参数</h3>
    <ul>
      <li>
        <p>1.限制容器的CPU和内存</p>
        <ul>
          <li>a.运行命令，<em>docker run <strong>-m 1024m --cpus=0.5</strong> --name auth -p 8080:8088 --link mysql:localhost -d auth:0.1</em></li>
          <li>b.查看运行状态，<em>docker container stats auth</em></li>
        </ul>
      </li>
      <li>
        <p>2.设置应用的最大内存和线程数</p>
        <ul>
          <li>a.运行命令，<em>docker run -m 512m --cpus=0.5 <strong>-e server.tomcat.max-threads='60'</strong> --name auth -p 8080:8088 --link mysql:localhost -d auth:0.1</em></li>
          <li>b.在浏览器里查看内存，http://localhost:8080/jolokia/read/java.lang:type=Memory</li>
          <li>c.在浏览器里查看线程，http://localhost:8080/jolokia/read/Tomcat:type=ThreadPool,name=%22http-nio-8088%22/maxThreads</li>
        </ul>
      </li>
    </ul>
    <h3>5. 容器的导出和导入</h3>
    <ul>
      <li>1.将容器转为一个镜像，命令中第一个auth是容器名字，第二个auth:0.2是镜像名字和标签
<ul><li><em>docker commit auth auth:0.2</em></li></ul></li>
      <li>2.将镜像导出为一个文件
<ul><li><em>docker save auth:0.2 &gt; auth.0.2.di.tar</em></li></ul></li>
      <li>3.删除镜像和容器
<ul><li><em>docker rm auth</em></li><li><em>docker rmi auth:0.2</em></li></ul></li>
      <li>4.从一个文件导入镜像
<ul><li><em>docker load &lt; auth.0.2.di.tar</em></li></ul></li>
      <li>5.运行这个镜像
<ul><li><em>docker run -m 1024m --cpus=0.5 --name auth -p 8080:8088 --link mysql:localhost -d auth:0.2</em></li></ul></li>
      <li>6.原先设置的环境变量都已经被写入镜像，所以运行是不用设置了</li>
    </ul>
  </body>
</html>
